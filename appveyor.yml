version: 0.0.{build}
image: Ubuntu1804
environment:
  NPM_TOKEN:
    secure: CSzo9P7e9If8tU0CpcPKLr4wGqEvDvnsiJFw1+IoVdDUsKnPdXK+zan4xGV70d70
  GIT_AUTHOR_NAME: AppVeyor
  GIT_AUTHOR_EMAIL: build@redpoint.games
build_script:
- sh: git config --global user.email "build@redpoint.games"
- sh: git config --global user.name "AppVeyor"
- sh: yarn version --new-version $APPVEYOR_BUILD_VERSION
- sh: yarn build
test_script:
- sh: yarn test
deploy_script:
- pwsh: >-
    if ($ENV:CONFIGURATION -eq "publish")
    {
      "//registry.npmjs.org/:_authToken=`$`{NPM_TOKEN`}" | Out-File (Join-Path $ENV:APPVEYOR_BUILD_FOLDER ".npmrc") -Encoding UTF8
      iex "npm pack"
      iex "npm publish"
    }
  on: 
    branch: master